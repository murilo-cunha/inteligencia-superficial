<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Sistemas de recommendação - Neural Collaborative Filtering | Inteligência Superficial</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Sistemas de recommendação - Neural Collaborative Filtering" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Com demo sobre Neural Collaborative Filtering" />
<meta property="og:description" content="Com demo sobre Neural Collaborative Filtering" />
<link rel="canonical" href="https://murilo-cunha.github.io/inteligencia-superficial/demo/neural%20networks/deep%20learning/recommender%20systems/paper/2020/12/17/neural_collaborative_filter.html" />
<meta property="og:url" content="https://murilo-cunha.github.io/inteligencia-superficial/demo/neural%20networks/deep%20learning/recommender%20systems/paper/2020/12/17/neural_collaborative_filter.html" />
<meta property="og:site_name" content="Inteligência Superficial" />
<meta property="og:image" content="https://raw.githubusercontent.com/murilo-cunha/inteligencia-superficial/master/images/2020-09-11-neural_collaborative_filter/cover.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-12-17T00:00:00-06:00" />
<script type="application/ld+json">
{"description":"Com demo sobre Neural Collaborative Filtering","@type":"BlogPosting","headline":"Sistemas de recommendação - Neural Collaborative Filtering","dateModified":"2020-12-17T00:00:00-06:00","datePublished":"2020-12-17T00:00:00-06:00","url":"https://murilo-cunha.github.io/inteligencia-superficial/demo/neural%20networks/deep%20learning/recommender%20systems/paper/2020/12/17/neural_collaborative_filter.html","mainEntityOfPage":{"@type":"WebPage","@id":"https://murilo-cunha.github.io/inteligencia-superficial/demo/neural%20networks/deep%20learning/recommender%20systems/paper/2020/12/17/neural_collaborative_filter.html"},"image":"https://raw.githubusercontent.com/murilo-cunha/inteligencia-superficial/master/images/2020-09-11-neural_collaborative_filter/cover.png","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/inteligencia-superficial/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://murilo-cunha.github.io/inteligencia-superficial/feed.xml" title="Inteligência Superficial" /><link rel="shortcut icon" type="image/x-icon" href="/inteligencia-superficial/images/favicon.ico"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Sistemas de recommendação - Neural Collaborative Filtering | Inteligência Superficial</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Sistemas de recommendação - Neural Collaborative Filtering" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Com demo sobre Neural Collaborative Filtering" />
<meta property="og:description" content="Com demo sobre Neural Collaborative Filtering" />
<link rel="canonical" href="https://murilo-cunha.github.io/inteligencia-superficial/demo/neural%20networks/deep%20learning/recommender%20systems/paper/2020/12/17/neural_collaborative_filter.html" />
<meta property="og:url" content="https://murilo-cunha.github.io/inteligencia-superficial/demo/neural%20networks/deep%20learning/recommender%20systems/paper/2020/12/17/neural_collaborative_filter.html" />
<meta property="og:site_name" content="Inteligência Superficial" />
<meta property="og:image" content="https://raw.githubusercontent.com/murilo-cunha/inteligencia-superficial/master/images/2020-09-11-neural_collaborative_filter/cover.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-12-17T00:00:00-06:00" />
<script type="application/ld+json">
{"description":"Com demo sobre Neural Collaborative Filtering","@type":"BlogPosting","headline":"Sistemas de recommendação - Neural Collaborative Filtering","dateModified":"2020-12-17T00:00:00-06:00","datePublished":"2020-12-17T00:00:00-06:00","url":"https://murilo-cunha.github.io/inteligencia-superficial/demo/neural%20networks/deep%20learning/recommender%20systems/paper/2020/12/17/neural_collaborative_filter.html","mainEntityOfPage":{"@type":"WebPage","@id":"https://murilo-cunha.github.io/inteligencia-superficial/demo/neural%20networks/deep%20learning/recommender%20systems/paper/2020/12/17/neural_collaborative_filter.html"},"image":"https://raw.githubusercontent.com/murilo-cunha/inteligencia-superficial/master/images/2020-09-11-neural_collaborative_filter/cover.png","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<link href="https://unpkg.com/@primer/css/dist/primer.css" rel="stylesheet" />
<link rel="stylesheet" href="//use.fontawesome.com/releases/v5.0.7/css/all.css"><link type="application/atom+xml" rel="alternate" href="https://murilo-cunha.github.io/inteligencia-superficial/feed.xml" title="Inteligência Superficial" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
    <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"> </script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head><body><div class="wrapper-masthead">
  <div class="container">
    <header class="masthead clearfix"><a href="/inteligencia-superficial/" class="site-avatar"><img src="https://murilo-cunha.github.io/inteligencia-superficial/images/avatar.png" /></a><div class="site-info"><h1 class="header-title"><a class="site-title" rel="author site-title-h1" href="/inteligencia-superficial/">Inteligência Superficial</a>
        </h1>
        <p class="site-description">Mergulhando de cabeça em inteligência artificial e machine learning</p>
      </div><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>
        
        <div class="trigger"><a class="page-link" href="/inteligencia-superficial/sobre/">Sobre</a><a class="page-link" href="/inteligencia-superficial/recursos/">Outros recursos</a><a class="page-link" href="/inteligencia-superficial/pesquisa/">Pesquisa</a><a class="page-link" href="/inteligencia-superficial/categories/">Categorias</a></div>
      </nav></header>
  </div>
</div> 
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Sistemas de recommendação - Neural Collaborative Filtering</h1><p class="page-description">Com demo sobre Neural Collaborative Filtering</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-12-17T00:00:00-06:00" itemprop="datePublished">
        Dec 17, 2020
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      22 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/inteligencia-superficial/categories/#demo">demo</a>
        &nbsp;
      
        <a class="category-tags-link" href="/inteligencia-superficial/categories/#neural networks">neural networks</a>
        &nbsp;
      
        <a class="category-tags-link" href="/inteligencia-superficial/categories/#deep learning">deep learning</a>
        &nbsp;
      
        <a class="category-tags-link" href="/inteligencia-superficial/categories/#recommender systems">recommender systems</a>
        &nbsp;
      
        <a class="category-tags-link" href="/inteligencia-superficial/categories/#paper">paper</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">

    <a href="https://github.com/murilo-cunha/inteligencia-superficial/tree/master/_notebooks/2020-12-17-neural_collaborative_filter.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/inteligencia-superficial/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/murilo-cunha/inteligencia-superficial/master?filepath=_notebooks%2F2020-12-17-neural_collaborative_filter.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/inteligencia-superficial/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/murilo-cunha/inteligencia-superficial/blob/master/_notebooks/2020-12-17-neural_collaborative_filter.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/inteligencia-superficial/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h1"><a href="#Neural-collaborative-filtering">Neural collaborative filtering </a></li>
<li class="toc-entry toc-h1"><a href="#TL;-DR">TL; DR </a></li>
<li class="toc-entry toc-h1"><a href="#Sistemas-de-recomendação">Sistemas de recomendação </a>
<ul>
<li class="toc-entry toc-h2"><a href="#🥅-Objetivo">🥅 Objetivo </a></li>
<li class="toc-entry toc-h2"><a href="#📚-Dados">📚 Dados </a>
<ul>
<li class="toc-entry toc-h3"><a href="#💬-Feedback-explícito-x-implícito">💬 Feedback explícito x implícito </a></li>
<li class="toc-entry toc-h3"><a href="#🔪-Divisão-de-"test"-e-"train"">🔪 Divisão de &quot;test&quot; e &quot;train&quot; </a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#🤖-Abordagens">🤖 Abordagens </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Content-based-filtering">Content based filtering </a></li>
<li class="toc-entry toc-h3"><a href="#Collaborative-filtering">Collaborative filtering </a></li>
<li class="toc-entry toc-h3"><a href="#Abordagem-híbrida">Abordagem híbrida </a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#🤔-Avaliação">🤔 Avaliação </a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#💁‍♂️-Collaborative-filtering">💁‍♂️ Collaborative filtering </a>
<ul>
<li class="toc-entry toc-h2"><a href="#Fatoração-de-matriz">Fatoração de matriz </a></li>
<li class="toc-entry toc-h2"><a href="#ML">ML </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Isso-faz-sentido?">Isso faz sentido? </a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#🧠-Neural-collaborative-filtering">🧠 Neural collaborative filtering </a>
<ul>
<li class="toc-entry toc-h2"><a href="#Parte-"Neural"">Parte &quot;Neural&quot; </a></li>
<li class="toc-entry toc-h2"><a href="#💪-Ganhos">💪 Ganhos </a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#💻-Demo">💻 Demo </a></li>
<li class="toc-entry toc-h1"><a href="#Os-dados">Os dados </a></li>
<li class="toc-entry toc-h1"><a href="#O-modelo-(Neural-Collaborative-Filtering)">O modelo (Neural Collaborative Filtering) </a></li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2020-12-17-neural_collaborative_filter.ipynb
-->

<div class="container" id="notebook-container">
        
    
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Neural-collaborative-filtering">
<a class="anchor" href="#Neural-collaborative-filtering" aria-hidden="true"><span class="octicon octicon-link"></span></a>Neural collaborative filtering<a class="anchor-link" href="#Neural-collaborative-filtering"> </a>
</h1>
<h1 id="TL;-DR">
<a class="anchor" href="#TL;-DR" aria-hidden="true"><span class="octicon octicon-link"></span></a>TL; DR<a class="anchor-link" href="#TL;-DR"> </a>
</h1>
<p>
</p>
<center>
    <iframe width="560" height="315" src="https://www.youtube.com/embed/SD3irxdKfxk" frameborder="0" allowfullscreen=""></iframe>
</center>

Rootlabs @ lunch session on Neural Collaborative Filtering
<hr>
<h1 id="Sistemas-de-recomendação">
<a class="anchor" href="#Sistemas-de-recomenda%C3%A7%C3%A3o" aria-hidden="true"><span class="octicon octicon-link"></span></a>Sistemas de recomendação<a class="anchor-link" href="#Sistemas-de-recomenda%C3%A7%C3%A3o"> </a>
</h1>
<h2 id="🥅-Objetivo">
<a class="anchor" href="#%F0%9F%A5%85-Objetivo" aria-hidden="true"><span class="octicon octicon-link"></span></a>🥅 Objetivo<a class="anchor-link" href="#%F0%9F%A5%85-Objetivo"> </a>
</h2>
<p>O objetivo é gerar recomendações para um usuário. O sistema de recomendação perfeito recomendaria a um usuário um item que ele gostaria, e que a pessoa não chegaria ao item sozinha. Portanto, um modelo que recomenda os itens mais populares para todos os usuários não é considerado um bom sistema de recomendação - as recomendações não são personalizadas.</p>
<p>O resultado principal de um modelo seria, por exemplo, os 10 principais itens que um usuário pode gostar e ainda não viu.</p>
<h2 id="📚-Dados">
<a class="anchor" href="#%F0%9F%93%9A-Dados" aria-hidden="true"><span class="octicon octicon-link"></span></a>📚 Dados<a class="anchor-link" href="#%F0%9F%93%9A-Dados"> </a>
</h2>
<p>Os dados <strong>podem</strong> incluir informações sobre o usuário (ou seja: idade, sexo, informações sobre compras anteriores), mas <strong>deve</strong> incluir informações da interação entre usuários e itens - se um usuário comprou/gostou/avaliou um item. Essa interação costuma ser chamada de <strong>feedback</strong>. Existem dois tipos diferentes de feedback: explícito e implícito.</p>
<h3 id="💬-Feedback-explícito-x-implícito">
<a class="anchor" href="#%F0%9F%92%AC-Feedback-expl%C3%ADcito-x-impl%C3%ADcito" aria-hidden="true"><span class="octicon octicon-link"></span></a>💬 Feedback explícito x implícito<a class="anchor-link" href="#%F0%9F%92%AC-Feedback-expl%C3%ADcito-x-impl%C3%ADcito"> </a>
</h3>
<p><strong>Feedback explícito</strong> é a interação que o usuário fornece intencionalmente - classificações de 5 estrelas em um produto, a 👍 em um produto etc.</p>
<p><strong>Feedback implícito</strong> ocorre sempre que temos uma "dica" das preferências do usuário. Comprou, viu um filme, etc. Recebemos um interesse entre o usuário e o item, mas não um feedback concreto - se o usuário realmente gostou do item (só porque eu vi o filme, não significa que gostei).</p>
<p>Como se poderia imaginar, o feedback explícito é mais informativo do que o implícito. Mas, na maioria dos casos, esses dados não estão prontamente disponíveis ou são muito escassos. No restante desta postagem, vamos nos concentrar em situações nas quais recebemos feedback implícito.</p>
<p>Ao trabalhar com feedback implícito, antes de dividir os dados em teste e treinamento, precisamos fazer a suposição de que toda interação observada é positiva e a ausência de interação é negativa. No exemplo, todos os filmes que assisti eu gostei e todos os filmes que não assisti eu não gostaria (não é realista, mas necessário para definir o problema).</p>
<h3 id='🔪-Divisão-de-"test"-e-"train"'>
<a class="anchor" href="#%F0%9F%94%AA-Divis%C3%A3o-de-" test aria-hidden="true"><span class="octicon octicon-link"></span></a>🔪 Divisão de "test" e "train"<a class="anchor-link" href="#%F0%9F%94%AA-Divis%C3%A3o-de-%22test%22-e-%22train%22"> </a>
</h3>
<p>Depois de reunir todas as informações, temos todos os usuários, itens e interações. Podemos colocá-los em uma matriz - também conhecida como <strong>matriz de interação</strong>.</p>
<center>
<img src="https://developers.google.com/machine-learning/recommendation/images/1Dmatrix.svg" width="70%" description="Exemplo de matriz de interação entre usuários e filmes, do [Google Developers](https://developers.google.com/machine-learning/recommendation/collaborative/basics)."> </center>
<p>Ao construir o teste, uma ideia é manter uma interação entre um usuário e um item e tentar prever isso. Pela imagem acima, poderíamos impedir a entrada do casal ruivo Shrek para o teste.</p>
<p>Pode-se fazer isso amostrando uma interação aleatoriamente para cada usuário, mas é interessante ter em mente a taxa de teste do trem e a possibilidade de vazamento de dados. Pode ser melhor tentar dividir os dados usando os últimos <em>d</em> dias para teste e o restante para treinamento, ou algo mais próximo do caso de uso para o qual o modelo está sendo construído.</p>
<p>De certa forma, temos uma abordagem de aprendizado supervisionado, uma vez que estamos tentando prever dados rotulados. Mas, como mencionado antes, é anormal no sentido de que um rótulo "verdadeiro" no feedback implícito pode não corresponder ao usuário realmente ter gostado do item. A ruiva pode não ter gostado de Shrek, embora isso seja desconhecido para nós. Por outro lado, ela pode gostar de "Memento", mas não tinha conhecimento desse filme.</p>
<p>Mas isso é o melhor que podemos fazer com os dados que temos. Depois que os dados forem rotulados, as suposições feitas e tivermos uma divisão de teste e trem, podemos ver como modelar nossos problemas.</p>
<h2 id="🤖-Abordagens">
<a class="anchor" href="#%F0%9F%A4%96-Abordagens" aria-hidden="true"><span class="octicon octicon-link"></span></a>🤖 Abordagens<a class="anchor-link" href="#%F0%9F%A4%96-Abordagens"> </a>
</h2>
<p>Existem duas abordagens principais quando se trata de sistemas de recomendação - <strong>content based filtering</strong> e <strong>collaborative filtering</strong>.</p>
<h3 id="Content-based-filtering">
<a class="anchor" href="#Content-based-filtering" aria-hidden="true"><span class="octicon octicon-link"></span></a>Content based filtering<a class="anchor-link" href="#Content-based-filtering"> </a>
</h3>
<p>A ideia é usar as informações dos usuários para fazer previsões sobre se ele gostará no futuro. Essas informações podem incluir informações pessoais e informações de compras anteriores. A única coisa a se considerar é que o recurso está disponível para a maioria dos usuários.</p>
<p>A abordagem pode ser resumida a qualquer configuração de aprendizado supervisionado - temos recursos (do usuário e do item) e um rótulo que queremos prever. A partir daí, podemos usar qualquer modelo para classificação - de regressão logística a redes neurais.</p>
<p>Se tivermos um feedback explícito, também poderíamos construir um usuário <a href="https://developers.google.com/machine-learning/crash-course/embeddings/video-lecture">embedding</a> que tenha recursos no mesmo espaço que os itens, e calcular a semelhança entre eles. Por exemplo, se um usuário definiu que gosta de filmes de ação e drama, podemos procurar filmes de ação e drama.</p>
<p>Mas a ideia geral é ter recomendações específicas para um único usuário - o que ele gosta, em oposição ao collaborative filtering.</p>
<p><strong>Comparação:</strong></p>
<ul>
<li>👍 Escala bem - usa apenas dados de um usuário</li>
<li>👍 Posso recomendar interesses de nicho muito específicos - muito específicos para um usuário</li>
<li>👎 O modelo é incapaz de explorar e expandir os interesses dos usuários (coisas novas que ele não manifestou interesse no passado)</li>
<li>👎 Se o modelo for construído com recursos de engenharia manual, é necessário muito conhecimento de domínio e o modelo é tão bom quanto seus recursos</li>
</ul>
<h3 id="Collaborative-filtering">
<a class="anchor" href="#Collaborative-filtering" aria-hidden="true"><span class="octicon octicon-link"></span></a>Collaborative filtering<a class="anchor-link" href="#Collaborative-filtering"> </a>
</h3>
<p>Na collaborative filtering, não usamos recursos de usuário ou item. Nós nos concentramos inteiramente em nossa matriz de interação. A principal ideia de alto nível é descobrir o que um usuário vai gostar com base no que usuários semelhantes gostaram no passado.</p>
<center>
<img src="https://raw.githubusercontent.com/murilo-cunha/inteligencia-superficial/master/images/2020-09-11-neural_collaborative_filter/colab_filtering_high_lvl.png" width="70%" description="Ideia geral de collaborative filtering"> </center>
<p>Ideia principal com collaborative filtering.</p>
<p>Na imagem acima - o emoji de festa seria recomendado para caça-níqueis por ser semelhante ao demônio. Aqui, "usuários semelhantes" são aqueles que compraram os mesmos itens (ou semelhantes) no passado.</p>
<p>No collaborative filtering, olhamos apenas para todas as compras e todos os itens. Então o modelo não liga para o que são os itens e nem os usuários. Tentamos criar embeddings de usuário e item úteis com base nas interações entre usuários e itens - ou seja: a matriz de interação.</p>
<p>Essa é a ideia principal, mas vamos mergulhar no funcionamento desse modelo mais tarde.</p>
<p><strong>Comparação:</strong></p>
<ul>
<li>👍 Nenhum conhecimento necessário - não precisamos saber nada sobre o problema para o qual estamos modelando</li>
<li>👍 Pode generalizar interesses e recomendar mais itens novos para um usuário</li>
<li>👎 Não dimensiona bem - precisa de todas as interações de todos os itens e todos os usuários</li>
<li>👎 Não incluímos quaisquer outros recursos específicos do usuário nem recursos específicos do item</li>
<li>👎 Baseamos nosso modelo na matriz de interação - não podemos gerar previsões para usuários sem interação registrada (um novo usuário no varejo online, por exemplo); isso é conhecido como <strong>problema de inicialização a frio</strong> </li>
</ul>
<h3 id="Abordagem-híbrida">
<a class="anchor" href="#Abordagem-h%C3%ADbrida" aria-hidden="true"><span class="octicon octicon-link"></span></a>Abordagem híbrida<a class="anchor-link" href="#Abordagem-h%C3%ADbrida"> </a>
</h3>
<p>É possível um híbrido entre as duas abordagens. E na maioria dos casos o que é implementado. Em uma visão mais geral, o que é feito é ter os dois modelos lado a lado e pesar suas previsões. Também podemos determinar esses pesos de maneira orientada por dados.</p>
<p>Isso também permite o fallback quando não há dados de interação para um usuário. Nesse caso, nos concentramos na abordagem "content based" até que os dados de interação estejam disponíveis.</p>
<p>Uma implementação muito popular e fácil de usar é o <a href="https://making.lyst.com/lightfm/docs/home.html">modelo LightFM</a>, que é conhecido por alcançar resultados muito bons.</p>
<h2 id="🤔-Avaliação">
<a class="anchor" href="#%F0%9F%A4%94-Avalia%C3%A7%C3%A3o" aria-hidden="true"><span class="octicon octicon-link"></span></a>🤔 Avaliação<a class="anchor-link" href="#%F0%9F%A4%94-Avalia%C3%A7%C3%A3o"> </a>
</h2>
<p>Como se poderia imaginar, técnicas de avaliação de aprendizagem supervisionada podem ser aplicadas aqui, incluindo curvas de sustentação, ganhos cumulativos, entre outros. No entanto, como se espera que forneçamos ao usuário um conjunto de recomendações e não nos importamos necessariamente com previsões de baixa classificação, outros métodos de avaliação que diferem das abordagens tradicionais se aplicam.</p>
<p>As métricas populares incluem precisão superior @k, precisão @k e recall @k. <em>K</em> é o número de itens que recomendamos a um usuário (no exemplo inicial, usei k = 10). A ideia é calcular as métricas olhando apenas para os K itens mais bem classificados. <a href="https://www.tensorflow.org/api_docs/python/tf/keras/metrics?hl=fr">Tensorflow</a> também oferece essas métricas como uma opção para precisão regular e métricas de recall.</p>
<p>Também é possível avaliar que gama de itens estão sendo recomendados - para evitar modelos em que apenas um subconjunto de todos os itens aparecem como recomendações. Ou personalização - evite que os itens mais populares acabem como recomendações. <a href="https://github.com/statisticianinstilettos/recmetrics">Recmetrics</a> oferece algumas idéias para avaliação de motores de recomendação.</p>
<h1 id="💁‍♂️-Collaborative-filtering">
<a class="anchor" href="#%F0%9F%92%81%E2%80%8D%E2%99%82%EF%B8%8F-Collaborative-filtering" aria-hidden="true"><span class="octicon octicon-link"></span></a>💁‍♂️ Collaborative filtering<a class="anchor-link" href="#%F0%9F%92%81%E2%80%8D%E2%99%82%EF%B8%8F-Collaborative-filtering"> </a>
</h1>
<p>⚠️ Agora vamos mergulhar na matemática ⚠️</p>
<h2 id="Fatoração-de-matriz">
<a class="anchor" href="#Fatora%C3%A7%C3%A3o-de-matriz" aria-hidden="true"><span class="octicon octicon-link"></span></a>Fatoração de matriz<a class="anchor-link" href="#Fatora%C3%A7%C3%A3o-de-matriz"> </a>
</h2>
<p>Matematicamente falando, é uma ideia bastante direta - podemos fatorar a matriz de interação para obter os embeddings para os itens e usuários.</p>
<p>Semelhante à fatoração normal, estamos procurando as matrizes $U$ (para usuários) e $I$ (para itens) que, quando multiplicadas, geram a matriz de interação $R$ (para avaliações), ou</p>
<p>
$$U \cdot I = R$$
</p>
<p>Observe que $\cdot$ denota multiplicação de matrizes e que as matrizes $U$ e $I$ podem variar em suas dimensões dependendo do tamanho de seu vetor de incorporação.</p>
<p><img src="https://developers.google.com/machine-learning/recommendation/images/2Dmatrix.svg" alt="https://developers.google.com/machine-learning/recommendation/images/2Dmatrix.svg"></p>
<p>Exemplo de matriz de interação e matrizes de usuário (à esquerda) e item (em cima). O tamanho de incorporação neste exemplo é 2. Imagem de <a href="https://developers.google.com/machine-learning/recommendation/collaborative/basics">Google Developers</a>.</p>
<h2 id="ML">
<a class="anchor" href="#ML" aria-hidden="true"><span class="octicon octicon-link"></span></a>ML<a class="anchor-link" href="#ML"> </a>
</h2>
<p>Agora que sabemos o que queremos, como podemos implementar a solução?</p>
<p>É aqui que o aprendizado de máquina entra em ação. Aproximamos essas matrizes $U$ e $I$ com base em exemplos. Começamos com valores aleatórios para $U$ e $I$, produzindo um conjunto aleatório de números para $R_{pred}$, a matriz de interação aproximada. Podemos comparar $R_ {actual}$ e $R_ {pred}$ usando qualquer função de perda (pode pensar em algo como <a href="https://en.wikipedia.org/wiki/Cross_entropy#Cross-entropy_loss_function_and_logistic_regression">entropia cruzada binária</a> , mas somando para cada elemento na matriz) e iterar usando qualquer algoritmo de otimização (pode pensar em "<a href="https://en.wikipedia.org/wiki/Gradient_descent">gradient descent</a>"), alterando $U$ e $I$ incrementalmente para chegar mais perto de $R_ {real}$.</p>
<p>Depois de muitas iterações, devemos ter algo semelhante a</p>
<p><img src="https://developers.google.com/machine-learning/recommendation/images/Matrixfactor.svg" alt="https://developers.google.com/machine-learning/recommendation/images/Matrixfactor.svg"></p>
<p>A matriz de interação real à esquerda ($R_ {real}$) e a matriz aproximada, ou prevista, dadas as matrizes treinadas $U$ e $I$ ($R_ {pred}$). Imagem de <a href="https://developers.google.com/machine-learning/recommendation/collaborative/matrix">Google Developers</a>.</p>
<p>Depois de muitas iterações, a matriz converge na aproximação das interações reais e podemos produzir os itens com as pontuações de predição mais altas (que ele ainda não gostou). Voltando para a mulher ruiva, a modelo recomendaria "The Dark Knight Rises".</p>
<p>Existem outras alternativas alternativas como para perdas e algoritmos de otimização, que podem convergir mais rapidamente, mas podem ser mais caros computacionalmente, como os mínimos quadrados alternados ponderados (WALS). Os <a href="https://developers.google.com/machine-learning/recommendation/">Google Developers</a> oferecem uma <a href="https://developers.google.com/machine-learning/recommendation/collaborative/matrix">comparação geral</a> entre o "gradient descent" e o WALS. Continuaremos com a "gradient descent" assim que falaremos sobre redes neurais.</p>
<h3 id="Isso-faz-sentido?">
<a class="anchor" href="#Isso-faz-sentido?" aria-hidden="true"><span class="octicon octicon-link"></span></a>Isso faz sentido?<a class="anchor-link" href="#Isso-faz-sentido?"> </a>
</h3>
<p>Por que isso faz sentido com o que descrevemos acima?</p>
<p>Para tornar as coisas mais simples, digamos que os encaixes dos itens sejam fixos. É mais fácil ver que, se dois usuários com comportamento muito semelhante, eles acabariam com embeddings semelhantes e, portanto, um item apreciado por um usuário seria recomendado ao outro.</p>
<h1 id="🧠-Neural-collaborative-filtering">
<a class="anchor" href="#%F0%9F%A7%A0-Neural-collaborative-filtering" aria-hidden="true"><span class="octicon octicon-link"></span></a>🧠 Neural collaborative filtering<a class="anchor-link" href="#%F0%9F%A7%A0-Neural-collaborative-filtering"> </a>
</h1>
<h2 id='Parte-"Neural"'>
<a class="anchor" href="#Parte-" neural aria-hidden="true"><span class="octicon octicon-link"></span></a>Parte "Neural"<a class="anchor-link" href="#Parte-%22Neural%22"> </a>
</h2>
<p>A principal adição que temos nesta parte é incluir uma rede neural com esses embeddings que criamos. Isso não é diferente do processo de criação de embeddings de palavras com redes neurais. Nós aproximamos os embeddings aleatórios inicializados com base nos rótulos, usando retropropagação. É interessante adicionar funções não lineares às camadas da rede, uma vez que o "collaborative filtering" "vanilla" já cuida das combinações lineares entre os embeddings de usuário e item (no <a href="https://dzone.com/articles/visualizing-matrix">produto matriz</a>).</p>
<p><img src="https://lh6.googleusercontent.com/kioqr4bQsvJdfvl0YJwnnyNyLG3f55ChHzkYt9cRMQYHttemX9-5vK3-005tMBZdWCSkfkSt0hQjcNxDrV46wqOLRWCLQWyuxoNfX9dSYEF7JBWXIqH1oMcQlmAy6mtMyF1KuiZ2jjs" alt="Https://lh6.googleusercontent.com/kioqr4bQsvJdfvl0YJwnnyNyLG3f55ChHzkYt9cRMQYHttemX9-5vK3-005tMBZdWCSkfkSt0hQjcNxDrV46wqOLRWCLQWyuxoNfX9dSYEF7JBWXIqH1oMcQlmAy6mtMyF1KuiZ2jjs"></p>
<p>Rede neural para "collaborative filtering", com base no usuário e embeddings de itens. Na camada de entrada, $u$ e $i$ são uma codificação ativa que representa o índice desse usuário. Imagem do artigo <a href="https://arxiv.org/pdf/1708.05031.pdf">Neural Collaborative Filtering</a>.</p>
<p>Pode-se notar que as representações aqui serão diferentes daquelas encontradas no "collaborative filtering" "vanilla". A ideia não é "substituir", mas "adicionar". Podemos realizar a fatoração da matriz como uma rede neural, concatenar as camadas finais e passá-las por uma camada final que produzirá as previsões. Todos juntos, vai parecer</p>
<p><img src="https://lh4.googleusercontent.com/_UeIXyWB5RiO-wapO60ZpeB2f9MjGmXRnJk2hCUHtXdAuGyHtbTRgO8RmYCix4bWt4Snh8LUEBgiuexUR_VmsdQjo9aH4i35G3YiI8lBcyMYbNuOs1po_xjlfhudWDpnJ5O4RsKj3mw" alt="Https://lh4.googleusercontent.com/_UeIXyWB5RiO-wapO60ZpeB2f9MjGmXRnJk2hCUHtXdAuGyHtbTRgO8RmYCix4bWt4Snh8LUEBgiuexUR_VmsdQjo9aH4i35G3YiI8lBcyMYbNuOs1po_xjlfhudWDpnJ5O4RsKj3mw"></p>
<p>Arquitetura neural colaborativa. Imagem do artigo <a href="https://arxiv.org/pdf/1708.05031.pdf">Neural Collaborative Filtering</a>.</p>
<p>Esses dois modelos diferentes juntos formam a arquitetura geral. Eles podem, no entanto, ser treinados separadamente e ajustados no final (aprendizagem por transferência). Isso pode acelerar o tempo de treinamento e produzir melhores resultados.</p>
<h2 id="💪-Ganhos">
<a class="anchor" href="#%F0%9F%92%AA-Ganhos" aria-hidden="true"><span class="octicon octicon-link"></span></a>💪 Ganhos<a class="anchor-link" href="#%F0%9F%92%AA-Ganhos"> </a>
</h2>
<p>A questão é: a complexidade adicional vale a pena?</p>
<p>Ao comparar experimentalmente os resultados usando o <a href="https://grouplens.org/datasets/movielens/">conjunto de dados MovieLens</a>, os resultados entre o LightFM e o neural collaborative filtering foram semelhantes (sinta-se à vontade para dar uma olhada na demo!), com um custo computacional consideravelmente maior para redes neurais.</p>
<p>Mas, por outro lado, obtemos mais flexibilidade com o modelo. Além do mais, podemos integrar facilmente um modelo de content based filtering (usando redes neurais) para formar um sistema de recomendação híbrido no Tensorflow. E a complexidade dos problemas que podem ser resolvidos também aumenta - problemas complexos de PNL ou de série temporal podem ser integrados. Poderíamos, por exemplo, alavancar modelos pré-treinados como o BERT e integrá-los neste sistema híbrido de recomendação.</p>
<h1 id="💻-Demo">
<a class="anchor" href="#%F0%9F%92%BB-Demo" aria-hidden="true"><span class="octicon octicon-link"></span></a>💻 Demo<a class="anchor-link" href="#%F0%9F%92%BB-Demo"> </a>
</h1>
<p>Caso esteja rodando o notebook não esqueça de fazer o download das bibliotecas e inicie o <code>tensorboard</code> no background:</p>
<p>No terminal</p>
<div class="highlight"><pre><span></span>pip install tensorflow lightfm pandas
tensorboard --logdir <span class="m">2020</span>-09-11-neural_collaborative_filter/logs
</pre></div>
<p>ou no notebook</p>
<div class="highlight"><pre><span></span><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">tensorflow</span> <span class="n">lightfm</span> <span class="n">pandas</span>
</pre></div>
<div class="highlight"><pre><span></span><span class="o">%</span><span class="n">load_ext</span> <span class="n">tensorboard</span>
<span class="err">!</span><span class="n">tensorboard</span> <span class="o">--</span><span class="n">logdir</span> <span class="mi">2020</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="n">neural_collaborative_filter</span><span class="o">/</span><span class="n">logs</span> <span class="o">&amp;</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Os-dados">
<a class="anchor" href="#Os-dados" aria-hidden="true"><span class="octicon octicon-link"></span></a>Os dados<a class="anchor-link" href="#Os-dados"> </a>
</h1>
<p><img src="https://developers.google.com/machine-learning/recommendation/images/Matrixfactor.svg" alt="" title="Credit: https://developers.google.com/machine-learning/recommendation/collaborative/basics"></p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Interaction matrix:
[[5 3 4 3 3 5 4 0 5 3]
 [4 0 0 0 0 0 0 0 0 0]
 [0 0 0 0 0 0 0 0 0 0]
 [0 0 0 0 0 0 0 0 0 0]
 [0 0 0 0 0 0 0 0 0 0]
 [4 0 0 0 0 0 0 4 4 0]
 [0 0 0 5 0 0 5 5 5 4]
 [0 0 0 0 0 0 3 0 0 0]
 [0 0 0 0 0 0 4 0 0 0]
 [4 0 0 4 0 0 0 0 4 0]]
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#collapse</span>
<span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"test"</span><span class="p">,</span> <span class="s2">"train"</span><span class="p">]:</span>
    <span class="n">data</span><span class="p">[</span><span class="n">dataset</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">dataset</span><span class="p">]</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">"int8"</span><span class="p">)</span>

<span class="c1"># Make the ratings binary</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Interaction matrix:"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">"train"</span><span class="p">][:</span><span class="mi">10</span><span class="p">,</span> <span class="p">:</span><span class="mi">10</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Ratings:"</span><span class="p">)</span>
<span class="n">unique_ratings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">"train"</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">unique_ratings</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Interaction matrix:
[[1 1 1 1 1 1 1 0 1 1]
 [1 0 0 0 0 0 0 0 0 0]
 [0 0 0 0 0 0 0 0 0 0]
 [0 0 0 0 0 0 0 0 0 0]
 [0 0 0 0 0 0 0 0 0 0]
 [1 0 0 0 0 0 0 1 1 0]
 [0 0 0 1 0 0 1 1 1 1]
 [0 0 0 0 0 0 1 0 0 0]
 [0 0 0 0 0 0 1 0 0 0]
 [1 0 0 1 0 0 0 0 1 0]]

Ratings:
[0 1]
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>


<span class="k">def</span> <span class="nf">wide_to_long</span><span class="p">(</span><span class="n">wide</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">possible_ratings</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
    <span class="sd">"""Go from wide table to long.</span>
<span class="sd">    :param wide: wide array with user-item interactions</span>
<span class="sd">    :param possible_ratings: list of possible ratings that we may have."""</span>

    <span class="k">def</span> <span class="nf">_get_ratings</span><span class="p">(</span><span class="n">arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">rating</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
        <span class="sd">"""Generate long array for the rating provided</span>
<span class="sd">        :param arr: wide array with user-item interactions</span>
<span class="sd">        :param rating: the rating that we are interested"""</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">arr</span> <span class="o">==</span> <span class="n">rating</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span>
            <span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">idx</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"int8"</span><span class="p">)</span> <span class="o">*</span> <span class="n">rating</span><span class="p">)</span>
        <span class="p">)</span><span class="o">.</span><span class="n">T</span>

    <span class="n">long_arrays</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">possible_ratings</span><span class="p">:</span>
        <span class="n">long_arrays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_get_ratings</span><span class="p">(</span><span class="n">wide</span><span class="p">,</span> <span class="n">r</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">long_arrays</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">long_train</span> <span class="o">=</span> <span class="n">wide_to_long</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">"train"</span><span class="p">],</span> <span class="n">unique_ratings</span><span class="p">)</span>
<span class="n">df_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">long_train</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"user_id"</span><span class="p">,</span> <span class="s2">"item_id"</span><span class="p">,</span> <span class="s2">"interaction"</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>All interactions:
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>user_id</th>
      <th>item_id</th>
      <th>interaction</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>7</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>10</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>19</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>20</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>26</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Only positive interactions:
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>user_id</th>
      <th>item_id</th>
      <th>interaction</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1511499</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1511500</th>
      <td>0</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1511501</th>
      <td>0</td>
      <td>2</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1511502</th>
      <td>0</td>
      <td>3</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1511503</th>
      <td>0</td>
      <td>4</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="O-modelo-(Neural-Collaborative-Filtering)">
<a class="anchor" href="#O-modelo-(Neural-Collaborative-Filtering)" aria-hidden="true"><span class="octicon octicon-link"></span></a>O modelo (Neural Collaborative Filtering)<a class="anchor-link" href="#O-modelo-(Neural-Collaborative-Filtering)"> </a>
</h1>
<center>
<img src="https://raw.githubusercontent.com/murilo-cunha/inteligencia-superficial/master/images/2020-09-11-neural_collaborative_filter/ncf_all_with_alpha.png" width="70%" url="https://developers.google.com/machine-learning/recommendation/collaborative/basics" description="Fonte: https://developers.google.com/machine-learning/recommendation/collaborative/basics"> </center>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">tensorflow.keras</span> <span class="k">as</span> <span class="nn">keras</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Concatenate</span><span class="p">,</span>
    <span class="n">Dense</span><span class="p">,</span>
    <span class="n">Embedding</span><span class="p">,</span>
    <span class="n">Flatten</span><span class="p">,</span>
    <span class="n">Input</span><span class="p">,</span>
    <span class="n">Multiply</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.models</span> <span class="kn">import</span> <span class="n">Model</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.regularizers</span> <span class="kn">import</span> <span class="n">l2</span>


<span class="k">def</span> <span class="nf">create_ncf</span><span class="p">(</span>
    <span class="n">number_of_users</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">number_of_items</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">latent_dim_mf</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
    <span class="n">latent_dim_mlp</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span>
    <span class="n">reg_mf</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">reg_mlp</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
    <span class="n">dense_layers</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
    <span class="n">reg_layers</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">],</span>
    <span class="n">activation_dense</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"relu"</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">:</span>

    <span class="c1"># input layer</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"int32"</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"user_id"</span><span class="p">)</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"int32"</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"item_id"</span><span class="p">)</span>

    <span class="c1"># embedding layers</span>
    <span class="n">mf_user_embedding</span> <span class="o">=</span> <span class="n">Embedding</span><span class="p">(</span>
        <span class="n">input_dim</span><span class="o">=</span><span class="n">number_of_users</span><span class="p">,</span>
        <span class="n">output_dim</span><span class="o">=</span><span class="n">latent_dim_mf</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">"mf_user_embedding"</span><span class="p">,</span>
        <span class="n">embeddings_initializer</span><span class="o">=</span><span class="s2">"RandomNormal"</span><span class="p">,</span>
        <span class="n">embeddings_regularizer</span><span class="o">=</span><span class="n">l2</span><span class="p">(</span><span class="n">reg_mf</span><span class="p">),</span>
        <span class="n">input_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">mf_item_embedding</span> <span class="o">=</span> <span class="n">Embedding</span><span class="p">(</span>
        <span class="n">input_dim</span><span class="o">=</span><span class="n">number_of_items</span><span class="p">,</span>
        <span class="n">output_dim</span><span class="o">=</span><span class="n">latent_dim_mf</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">"mf_item_embedding"</span><span class="p">,</span>
        <span class="n">embeddings_initializer</span><span class="o">=</span><span class="s2">"RandomNormal"</span><span class="p">,</span>
        <span class="n">embeddings_regularizer</span><span class="o">=</span><span class="n">l2</span><span class="p">(</span><span class="n">reg_mf</span><span class="p">),</span>
        <span class="n">input_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">mlp_user_embedding</span> <span class="o">=</span> <span class="n">Embedding</span><span class="p">(</span>
        <span class="n">input_dim</span><span class="o">=</span><span class="n">number_of_users</span><span class="p">,</span>
        <span class="n">output_dim</span><span class="o">=</span><span class="n">latent_dim_mlp</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">"mlp_user_embedding"</span><span class="p">,</span>
        <span class="n">embeddings_initializer</span><span class="o">=</span><span class="s2">"RandomNormal"</span><span class="p">,</span>
        <span class="n">embeddings_regularizer</span><span class="o">=</span><span class="n">l2</span><span class="p">(</span><span class="n">reg_mlp</span><span class="p">),</span>
        <span class="n">input_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">mlp_item_embedding</span> <span class="o">=</span> <span class="n">Embedding</span><span class="p">(</span>
        <span class="n">input_dim</span><span class="o">=</span><span class="n">number_of_items</span><span class="p">,</span>
        <span class="n">output_dim</span><span class="o">=</span><span class="n">latent_dim_mlp</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">"mlp_item_embedding"</span><span class="p">,</span>
        <span class="n">embeddings_initializer</span><span class="o">=</span><span class="s2">"RandomNormal"</span><span class="p">,</span>
        <span class="n">embeddings_regularizer</span><span class="o">=</span><span class="n">l2</span><span class="p">(</span><span class="n">reg_mlp</span><span class="p">),</span>
        <span class="n">input_length</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># MF vector</span>
    <span class="n">mf_user_latent</span> <span class="o">=</span> <span class="n">Flatten</span><span class="p">()(</span><span class="n">mf_user_embedding</span><span class="p">(</span><span class="n">user</span><span class="p">))</span>
    <span class="n">mf_item_latent</span> <span class="o">=</span> <span class="n">Flatten</span><span class="p">()(</span><span class="n">mf_item_embedding</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
    <span class="n">mf_cat_latent</span> <span class="o">=</span> <span class="n">Multiply</span><span class="p">()([</span><span class="n">mf_user_latent</span><span class="p">,</span> <span class="n">mf_item_latent</span><span class="p">])</span>

    <span class="c1"># MLP vector</span>
    <span class="n">mlp_user_latent</span> <span class="o">=</span> <span class="n">Flatten</span><span class="p">()(</span><span class="n">mlp_user_embedding</span><span class="p">(</span><span class="n">user</span><span class="p">))</span>
    <span class="n">mlp_item_latent</span> <span class="o">=</span> <span class="n">Flatten</span><span class="p">()(</span><span class="n">mlp_item_embedding</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
    <span class="n">mlp_cat_latent</span> <span class="o">=</span> <span class="n">Concatenate</span><span class="p">()([</span><span class="n">mlp_user_latent</span><span class="p">,</span> <span class="n">mlp_item_latent</span><span class="p">])</span>

    <span class="n">mlp_vector</span> <span class="o">=</span> <span class="n">mlp_cat_latent</span>

    <span class="c1"># build dense layers for model</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dense_layers</span><span class="p">)):</span>
        <span class="n">layer</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span>
            <span class="n">dense_layers</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="n">activity_regularizer</span><span class="o">=</span><span class="n">l2</span><span class="p">(</span><span class="n">reg_layers</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
            <span class="n">activation</span><span class="o">=</span><span class="n">activation_dense</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">"layer</span><span class="si">%d</span><span class="s2">"</span> <span class="o">%</span> <span class="n">i</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">mlp_vector</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="n">mlp_vector</span><span class="p">)</span>

    <span class="n">predict_layer</span> <span class="o">=</span> <span class="n">Concatenate</span><span class="p">()([</span><span class="n">mf_cat_latent</span><span class="p">,</span> <span class="n">mlp_vector</span><span class="p">])</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span>
        <span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s2">"sigmoid"</span><span class="p">,</span> <span class="n">kernel_initializer</span><span class="o">=</span><span class="s2">"lecun_uniform"</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"interaction"</span>
    <span class="p">)</span>

    <span class="n">output</span> <span class="o">=</span> <span class="n">result</span><span class="p">(</span><span class="n">predict_layer</span><span class="p">)</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span>
        <span class="n">inputs</span><span class="o">=</span><span class="p">[</span><span class="n">user</span><span class="p">,</span> <span class="n">item</span><span class="p">],</span>
        <span class="n">outputs</span><span class="o">=</span><span class="p">[</span><span class="n">output</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">model</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#collapse</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.optimizers</span> <span class="kn">import</span> <span class="n">Adam</span>

<span class="n">n_users</span><span class="p">,</span> <span class="n">n_items</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">"train"</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span>
<span class="n">ncf_model</span> <span class="o">=</span> <span class="n">create_ncf</span><span class="p">(</span><span class="n">n_users</span><span class="p">,</span> <span class="n">n_items</span><span class="p">)</span>

<span class="n">ncf_model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="n">optimizer</span><span class="o">=</span><span class="n">Adam</span><span class="p">(),</span>
    <span class="n">loss</span><span class="o">=</span><span class="s2">"binary_crossentropy"</span><span class="p">,</span>
    <span class="n">metrics</span><span class="o">=</span><span class="p">[</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">TruePositives</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"tp"</span><span class="p">),</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">FalsePositives</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"fp"</span><span class="p">),</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">TrueNegatives</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"tn"</span><span class="p">),</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">FalseNegatives</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"fn"</span><span class="p">),</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">BinaryAccuracy</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"accuracy"</span><span class="p">),</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">Precision</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"precision"</span><span class="p">),</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">Recall</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"recall"</span><span class="p">),</span>
        <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">AUC</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"auc"</span><span class="p">),</span>
    <span class="p">],</span>
<span class="p">)</span>
<span class="n">ncf_model</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="s2">"neural_collaborative_filtering"</span>
<span class="n">ncf_model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Model: "neural_collaborative_filtering"
__________________________________________________________________________________________________
Layer (type)                    Output Shape         Param #     Connected to                     
==================================================================================================
user_id (InputLayer)            [(None,)]            0                                            
__________________________________________________________________________________________________
item_id (InputLayer)            [(None,)]            0                                            
__________________________________________________________________________________________________
mlp_user_embedding (Embedding)  (None, 32)           30176       user_id[0][0]                    
__________________________________________________________________________________________________
mlp_item_embedding (Embedding)  (None, 32)           53824       item_id[0][0]                    
__________________________________________________________________________________________________
flatten_2 (Flatten)             (None, 32)           0           mlp_user_embedding[0][0]         
__________________________________________________________________________________________________
flatten_3 (Flatten)             (None, 32)           0           mlp_item_embedding[0][0]         
__________________________________________________________________________________________________
mf_user_embedding (Embedding)   (None, 4)            3772        user_id[0][0]                    
__________________________________________________________________________________________________
mf_item_embedding (Embedding)   (None, 4)            6728        item_id[0][0]                    
__________________________________________________________________________________________________
concatenate (Concatenate)       (None, 64)           0           flatten_2[0][0]                  
                                                                 flatten_3[0][0]                  
__________________________________________________________________________________________________
flatten (Flatten)               (None, 4)            0           mf_user_embedding[0][0]          
__________________________________________________________________________________________________
flatten_1 (Flatten)             (None, 4)            0           mf_item_embedding[0][0]          
__________________________________________________________________________________________________
layer0 (Dense)                  (None, 8)            520         concatenate[0][0]                
__________________________________________________________________________________________________
multiply (Multiply)             (None, 4)            0           flatten[0][0]                    
                                                                 flatten_1[0][0]                  
__________________________________________________________________________________________________
layer1 (Dense)                  (None, 4)            36          layer0[0][0]                     
__________________________________________________________________________________________________
concatenate_1 (Concatenate)     (None, 8)            0           multiply[0][0]                   
                                                                 layer1[0][0]                     
__________________________________________________________________________________________________
interaction (Dense)             (None, 1)            9           concatenate_1[0][0]              
==================================================================================================
Total params: 95,065
Trainable params: 95,065
Non-trainable params: 0
__________________________________________________________________________________________________
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">make_tf_dataset</span><span class="p">(</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">targets</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">val_split</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">512</span><span class="p">,</span>
    <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">"""Make TensorFlow dataset from Pandas DataFrame.</span>
<span class="sd">    :param df: input DataFrame - only contains features and target(s)</span>
<span class="sd">    :param targets: list of columns names corresponding to targets</span>
<span class="sd">    :param val_split: fraction of the data that should be used for validation</span>
<span class="sd">    :param batch_size: batch size for training</span>
<span class="sd">    :param seed: random seed for shuffling the data - setting to `None` will not shuffle the data"""</span>

    <span class="n">n_val</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">val_split</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">seed</span><span class="p">:</span>
        <span class="c1"># shuffle all the rows</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s2">"series"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="s2">"series"</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">targets</span><span class="p">:</span>
        <span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_tensor_slices</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>

    <span class="n">ds_val</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">n_val</span><span class="p">)</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">batch_size</span><span class="p">)</span>
    <span class="n">ds_train</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="n">n_val</span><span class="p">)</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">batch_size</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ds_train</span><span class="p">,</span> <span class="n">ds_val</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># create train and validation datasets</span>
<span class="n">ds_train</span><span class="p">,</span> <span class="n">ds_val</span> <span class="o">=</span> <span class="n">make_tf_dataset</span><span class="p">(</span><span class="n">df_train</span><span class="p">,</span> <span class="p">[</span><span class="s2">"interaction"</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="c1"># define logs and callbacks</span>
<span class="n">logdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">"logs"</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">"%Y%m</span><span class="si">%d</span><span class="s2">-%H%M%S"</span><span class="p">))</span>
<span class="n">tensorboard_callback</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">TensorBoard</span><span class="p">(</span><span class="n">logdir</span><span class="p">,</span> <span class="n">histogram_freq</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">early_stopping_callback</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">EarlyStopping</span><span class="p">(</span>
    <span class="n">monitor</span><span class="o">=</span><span class="s2">"val_loss"</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>

<span class="n">train_hist</span> <span class="o">=</span> <span class="n">ncf_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
    <span class="n">ds_train</span><span class="p">,</span>
    <span class="n">validation_data</span><span class="o">=</span><span class="n">ds_val</span><span class="p">,</span>
    <span class="n">epochs</span><span class="o">=</span><span class="n">N_EPOCHS</span><span class="p">,</span>
    <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">tensorboard_callback</span><span class="p">,</span> <span class="n">early_stopping_callback</span><span class="p">],</span>
    <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Epoch 1/10
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/usr/local/anaconda3/envs/inteligencia-superficial/lib/python3.7/site-packages/tensorflow/python/framework/indexed_slices.py:432: UserWarning: Converting sparse IndexedSlices to a dense Tensor of unknown shape. This may consume a large amount of memory.
  "Converting sparse IndexedSlices to a dense Tensor of unknown shape. "
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>   1/2789 [..............................] - ETA: 0s - loss: 2.7761 - tp: 1.0000 - fp: 32.0000 - tn: 459.0000 - fn: 20.0000 - accuracy: 0.8984 - precision: 0.0303 - recall: 0.0476 - auc: 0.4325WARNING:tensorflow:From /usr/local/anaconda3/envs/inteligencia-superficial/lib/python3.7/site-packages/tensorflow/python/ops/summary_ops_v2.py:1277: stop (from tensorflow.python.eager.profiler) is deprecated and will be removed after 2020-07-01.
Instructions for updating:
use `tf.profiler.experimental.stop` instead.
WARNING:tensorflow:Callbacks method `on_train_batch_end` is slow compared to the batch time (batch time: 0.0031s vs `on_train_batch_end` time: 0.0254s). Check your callbacks.
2789/2789 [==============================] - 9s 3ms/step - loss: 0.2318 - tp: 1691.0000 - fp: 789.0000 - tn: 1359625.0000 - fn: 65408.0000 - accuracy: 0.9536 - precision: 0.6819 - recall: 0.0252 - auc: 0.8033 - val_loss: 0.1408 - val_tp: 902.0000 - val_fp: 416.0000 - val_tn: 150669.0000 - val_fn: 6626.0000 - val_accuracy: 0.9556 - val_precision: 0.6844 - val_recall: 0.1198 - val_auc: 0.9020
Epoch 2/10
2789/2789 [==============================] - 8s 3ms/step - loss: 0.1279 - tp: 11668.0000 - fp: 6340.0000 - tn: 1354074.0000 - fn: 55431.0000 - accuracy: 0.9567 - precision: 0.6479 - recall: 0.1739 - auc: 0.9164 - val_loss: 0.1236 - val_tp: 1532.0000 - val_fp: 854.0000 - val_tn: 150231.0000 - val_fn: 5996.0000 - val_accuracy: 0.9568 - val_precision: 0.6421 - val_recall: 0.2035 - val_auc: 0.9195
Epoch 3/10
2789/2789 [==============================] - 8s 3ms/step - loss: 0.1191 - tp: 13715.0000 - fp: 7758.0000 - tn: 1352656.0000 - fn: 53384.0000 - accuracy: 0.9572 - precision: 0.6387 - recall: 0.2044 - auc: 0.9254 - val_loss: 0.1198 - val_tp: 1587.0000 - val_fp: 835.0000 - val_tn: 150250.0000 - val_fn: 5941.0000 - val_accuracy: 0.9573 - val_precision: 0.6552 - val_recall: 0.2108 - val_auc: 0.9232
Epoch 4/10
2789/2789 [==============================] - 8s 3ms/step - loss: 0.1148 - tp: 14333.0000 - fp: 7576.0000 - tn: 1352838.0000 - fn: 52766.0000 - accuracy: 0.9577 - precision: 0.6542 - recall: 0.2136 - auc: 0.9293 - val_loss: 0.1160 - val_tp: 1610.0000 - val_fp: 797.0000 - val_tn: 150288.0000 - val_fn: 5918.0000 - val_accuracy: 0.9577 - val_precision: 0.6689 - val_recall: 0.2139 - val_auc: 0.9267
Epoch 5/10
2789/2789 [==============================] - 8s 3ms/step - loss: 0.1114 - tp: 15531.0000 - fp: 7649.0000 - tn: 1352765.0000 - fn: 51568.0000 - accuracy: 0.9585 - precision: 0.6700 - recall: 0.2315 - auc: 0.9335 - val_loss: 0.1138 - val_tp: 1777.0000 - val_fp: 877.0000 - val_tn: 150208.0000 - val_fn: 5751.0000 - val_accuracy: 0.9582 - val_precision: 0.6696 - val_recall: 0.2361 - val_auc: 0.9294
Epoch 6/10
2789/2789 [==============================] - 8s 3ms/step - loss: 0.1088 - tp: 16978.0000 - fp: 8344.0000 - tn: 1352070.0000 - fn: 50121.0000 - accuracy: 0.9590 - precision: 0.6705 - recall: 0.2530 - auc: 0.9373 - val_loss: 0.1120 - val_tp: 1927.0000 - val_fp: 975.0000 - val_tn: 150110.0000 - val_fn: 5601.0000 - val_accuracy: 0.9585 - val_precision: 0.6640 - val_recall: 0.2560 - val_auc: 0.9317
Epoch 7/10
2789/2789 [==============================] - 8s 3ms/step - loss: 0.1069 - tp: 18235.0000 - fp: 9057.0000 - tn: 1351357.0000 - fn: 48864.0000 - accuracy: 0.9594 - precision: 0.6681 - recall: 0.2718 - auc: 0.9401 - val_loss: 0.1108 - val_tp: 2033.0000 - val_fp: 1031.0000 - val_tn: 150054.0000 - val_fn: 5495.0000 - val_accuracy: 0.9589 - val_precision: 0.6635 - val_recall: 0.2701 - val_auc: 0.9338
Epoch 8/10
2789/2789 [==============================] - 8s 3ms/step - loss: 0.1055 - tp: 19127.0000 - fp: 9621.0000 - tn: 1350793.0000 - fn: 47972.0000 - accuracy: 0.9597 - precision: 0.6653 - recall: 0.2851 - auc: 0.9421 - val_loss: 0.1100 - val_tp: 2113.0000 - val_fp: 1069.0000 - val_tn: 150016.0000 - val_fn: 5415.0000 - val_accuracy: 0.9591 - val_precision: 0.6640 - val_recall: 0.2807 - val_auc: 0.9350
Epoch 9/10
2789/2789 [==============================] - 8s 3ms/step - loss: 0.1046 - tp: 19749.0000 - fp: 9984.0000 - tn: 1350430.0000 - fn: 47350.0000 - accuracy: 0.9598 - precision: 0.6642 - recall: 0.2943 - auc: 0.9435 - val_loss: 0.1094 - val_tp: 2154.0000 - val_fp: 1107.0000 - val_tn: 149978.0000 - val_fn: 5374.0000 - val_accuracy: 0.9591 - val_precision: 0.6605 - val_recall: 0.2861 - val_auc: 0.9357
Epoch 10/10
2789/2789 [==============================] - 8s 3ms/step - loss: 0.1040 - tp: 20082.0000 - fp: 10168.0000 - tn: 1350246.0000 - fn: 47017.0000 - accuracy: 0.9599 - precision: 0.6639 - recall: 0.2993 - auc: 0.9445 - val_loss: 0.1090 - val_tp: 2191.0000 - val_fp: 1126.0000 - val_tn: 149959.0000 - val_fn: 5337.0000 - val_accuracy: 0.9593 - val_precision: 0.6605 - val_recall: 0.2910 - val_auc: 0.9364
CPU times: user 2min 29s, sys: 43.4 s, total: 3min 12s
Wall time: 1min 20s
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">long_test</span> <span class="o">=</span> <span class="n">wide_to_long</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">"train"</span><span class="p">],</span> <span class="n">unique_ratings</span><span class="p">)</span>
<span class="n">df_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">long_test</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"user_id"</span><span class="p">,</span> <span class="s2">"item_id"</span><span class="p">,</span> <span class="s2">"interaction"</span><span class="p">])</span>
<span class="n">ds_test</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">make_tf_dataset</span><span class="p">(</span><span class="n">df_test</span><span class="p">,</span> <span class="p">[</span><span class="s2">"interaction"</span><span class="p">],</span> <span class="n">val_split</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">ncf_predictions</span> <span class="o">=</span> <span class="n">ncf_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">ds_test</span><span class="p">)</span>
<span class="n">df_test</span><span class="p">[</span><span class="s2">"ncf_predictions"</span><span class="p">]</span> <span class="o">=</span> <span class="n">ncf_predictions</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 3.81 s, sys: 210 ms, total: 4.02 s
Wall time: 3.69 s
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>user_id</th>
      <th>item_id</th>
      <th>interaction</th>
      <th>ncf_predictions</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>7</td>
      <td>0</td>
      <td>0.523643</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>10</td>
      <td>0</td>
      <td>0.719504</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>19</td>
      <td>0</td>
      <td>0.100669</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>20</td>
      <td>0</td>
      <td>0.123813</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>26</td>
      <td>0</td>
      <td>0.102480</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#collapse</span>
<span class="n">data</span><span class="p">[</span><span class="s2">"ncf_predictions"</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_test</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span>
    <span class="n">index</span><span class="o">=</span><span class="s2">"user_id"</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">"item_id"</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s2">"ncf_predictions"</span>
<span class="p">)</span><span class="o">.</span><span class="n">values</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Neural collaborative filtering predictions"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">"ncf_predictions"</span><span class="p">][:</span><span class="mi">10</span><span class="p">,</span> <span class="p">:</span><span class="mi">4</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Neural collaborative filtering predictions
[[7.7809501e-01 3.4897393e-01 2.3736593e-01 7.5093412e-01]
 [1.5352371e-01 1.8476248e-03 2.3163706e-02 3.6399364e-03]
 [4.6624422e-02 4.7096610e-04 1.2840241e-02 1.1576419e-04]
 [8.5962385e-02 1.4925003e-03 6.1967373e-03 5.1632524e-04]
 [5.8516884e-01 2.8336483e-01 7.5634271e-02 3.0715367e-01]
 [4.0988737e-01 2.2669524e-02 1.0599941e-02 4.0282601e-01]
 [6.0177052e-01 6.6075641e-01 7.8367621e-02 8.1673837e-01]
 [4.9012059e-01 8.9323461e-02 6.3689947e-03 6.7939401e-02]
 [1.5069479e-01 1.3713539e-03 2.8979778e-04 2.2239387e-03]
 [5.0181168e-01 6.9155514e-02 3.4887791e-02 4.8452517e-01]]
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">precision_ncf</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">Precision</span><span class="p">(</span><span class="n">top_k</span><span class="o">=</span><span class="n">TOP_K</span><span class="p">)</span>
<span class="n">recall_ncf</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">Recall</span><span class="p">(</span><span class="n">top_k</span><span class="o">=</span><span class="n">TOP_K</span><span class="p">)</span>

<span class="n">precision_ncf</span><span class="o">.</span><span class="n">update_state</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">"test"</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">"ncf_predictions"</span><span class="p">])</span>
<span class="n">recall_ncf</span><span class="o">.</span><span class="n">update_state</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">"test"</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">"ncf_predictions"</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">"At K = </span><span class="si">{</span><span class="n">TOP_K</span><span class="si">}</span><span class="s2">, we have a precision of </span><span class="si">{</span><span class="n">precision_ncf</span><span class="o">.</span><span class="n">result</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2"> and a recall of </span><span class="si">{</span><span class="n">recall_ncf</span><span class="o">.</span><span class="n">result</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">"</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>At K = 5, we have a precision of 0.10859 and a recall of 0.06487
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="c1"># LightFM model</span>
<span class="n">norm</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">lightfm_model</span> <span class="o">=</span> <span class="n">LightFM</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s2">"warp"</span><span class="p">)</span>
<span class="n">lightfm_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">sparse</span><span class="o">.</span><span class="n">coo_matrix</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">"train"</span><span class="p">]),</span> <span class="n">epochs</span><span class="o">=</span><span class="n">N_EPOCHS</span><span class="p">)</span>

<span class="n">lightfm_predictions</span> <span class="o">=</span> <span class="n">lightfm_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
    <span class="n">df_test</span><span class="p">[</span><span class="s2">"user_id"</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">df_test</span><span class="p">[</span><span class="s2">"item_id"</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="p">)</span>
<span class="n">df_test</span><span class="p">[</span><span class="s2">"lightfm_predictions"</span><span class="p">]</span> <span class="o">=</span> <span class="n">lightfm_predictions</span>
<span class="n">wide_predictions</span> <span class="o">=</span> <span class="n">df_test</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span>
    <span class="n">index</span><span class="o">=</span><span class="s2">"user_id"</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">"item_id"</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s2">"lightfm_predictions"</span>
<span class="p">)</span><span class="o">.</span><span class="n">values</span>
<span class="n">data</span><span class="p">[</span><span class="s2">"lightfm_predictions"</span><span class="p">]</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">wide_predictions</span><span class="p">)</span>

<span class="c1"># compute the metrics</span>
<span class="n">precision_lightfm</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">Precision</span><span class="p">(</span><span class="n">top_k</span><span class="o">=</span><span class="n">TOP_K</span><span class="p">)</span>
<span class="n">recall_lightfm</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">Recall</span><span class="p">(</span><span class="n">top_k</span><span class="o">=</span><span class="n">TOP_K</span><span class="p">)</span>
<span class="n">precision_lightfm</span><span class="o">.</span><span class="n">update_state</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">"test"</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">"lightfm_predictions"</span><span class="p">])</span>
<span class="n">recall_lightfm</span><span class="o">.</span><span class="n">update_state</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">"test"</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">"lightfm_predictions"</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">"At K = </span><span class="si">{</span><span class="n">TOP_K</span><span class="si">}</span><span class="s2">, we have a precision of </span><span class="si">{</span><span class="n">precision_lightfm</span><span class="o">.</span><span class="n">result</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2"> and a recall of </span><span class="si">{</span><span class="n">recall_lightfm</span><span class="o">.</span><span class="n">result</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="si">:</span><span class="s2">.5f</span><span class="si">}</span><span class="s2">"</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>At K = 5, we have a precision of 0.10541 and a recall of 0.06297
CPU times: user 1.01 s, sys: 235 ms, total: 1.25 s
Wall time: 858 ms
</pre>
</div>
</div>

</div>
</div>

</div>
    

</div>



  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="murilo-cunha/inteligencia-superficial"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/inteligencia-superficial/demo/neural%20networks/deep%20learning/recommender%20systems/paper/2020/12/17/neural_collaborative_filter.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/inteligencia-superficial/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/inteligencia-superficial/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/inteligencia-superficial/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Inscreva-se</span>
          </a>
        </p>
        <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Licença Creative Commons" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a><br /><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Inteligência Superficial</span> de <a xmlns:cc="http://creativecommons.org/ns#" href="https://github.com/murilo-cunha/inteligencia-superficial" property="cc:attributionName" rel="cc:attributionURL">Murilo Cunha</a> está licenciado com uma Licença <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons - Atribuição-NãoComercial-CompartilhaIgual 4.0 Internacional</a>.
      </div>
      <!-- <div class="footer-col">
        <p>Mergulhando de cabeça em inteligência artificial e machine learning</p>
      </div> -->
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/murilo-cunha" title="murilo-cunha"><svg class="svg-icon grey"><use xlink:href="/inteligencia-superficial/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://www.linkedin.com/in/murilo-cunha" title="murilo-cunha"><svg class="svg-icon grey"><use xlink:href="/inteligencia-superficial/assets/minima-social-icons.svg#linkedin"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
